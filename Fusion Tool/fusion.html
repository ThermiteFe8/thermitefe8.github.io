<html>
<head>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

    <style type="text/css">
        #mynetwork {
            width: 600px;
            height: 400px;
            border: 1px solid lightgray;
        }
		#plantInformation {
            width: 400px;
            height: 400px;
            border: 1px solid lightgray;
        }
		#plantInformation *{
			margin-left:15px;
		}
		
		#displayContainer {
			display:flex;
			flex-direction:row;
		}
    </style>
</head>
	<body>
	<div id = "displayContainer">
		<div id="mynetwork"></div>
		<div id="plantInformation">
			<h3>Plant Name</h3>
			<p>Sun Cost</p>
			<p>Recharge</p>
			<p>DPS</p>
			<p>Almanac Description</p>
			<p>Base Plants</p>
			<p>Future Plants</p>
			<p>keywords</p>
		</div>
	</div>
	
	<input type="checkbox" class="plantProperties" id="basePlant" value="basePlant" checked = "true"></input>
	<label for="basePlant">Base Plants</label>
	<input type="checkbox" class="plantProperties" id = "straight" value="straight" checked = "true"></input>
	<label for="straight">Straight-Shooting Plants</label>
	<input type="checkbox" class="plantProperties" id = "sunProducer" value="sunProducer" checked = "true"></input>
	<label for="sunProducer">Sun Producing Plants</label>
	<input type="checkbox" class="plantProperties" id = "aggroSun" value="aggroSun" checked = "true"></input>
	<label for="aggroSun">Active Sun Producers</label>
	
	
	<button onclick="searchPlants()">Search</button>
		<script type="text/javascript">
			// create an array with nodes
			fetch('testJson.json')
			.then(response => response.json())
			.then(data => {
				console.log(data);
			})
			.catch(error => {
				console.error('Error fetching or parsing JSON:', error);
			});
			
			const tickboxes = document.getElementsByClassName("plantProperties");
			const infoCont = document.getElementById("plantInformation");
			
			var nodes = new vis.DataSet([
				{id: "Peashooter", label: 'Peashooter', properties: ["basePlant", "straight"], cost: 100, recharge: 7.5, DPS: "20/1.5s", description: "I'm a Peashooter"},
				{id: "Sunflower", label: 'Sunflower', properties: ["sunProducer", "basePlant"], cost: 50, recharge: 7.5, DPS: "25/25s", description: "I'm a Sunflower"},
				{id: "Sun Peashooter", label: 'Sun Peashooter', properties: ["sunProducer", "aggroSun", "straight"], DPS: "30/1.5s", description: "I'm a Sun Shooter"},
				{id: "Twin Sunflower", label: 'Twin Sunflower', properties: ["sunProducer"], DPS: "25 x 2/20s", description: "I'm a Twin Sunflower"},
				{id: "Repeater", label: 'Repeater', properties: ["straight"], DPS: "2 x 2/1.5s", description: "Repeater!"}
			]);
			
			const nodeIds = nodes.getIds();
			
			for(let k = 0; k < nodeIds.length; k++)
			{
				let node = nodes.get(nodeIds[k]);
				if(node.properties.includes("basePlant"))
				{
					node.color = "MediumSeaGreen";
					nodes.update(node);
				
				}
			}
			
			
			// create an array with edges
			var edges = new vis.DataSet([
				{from: "Peashooter", to: "Sun Peashooter"},
				{from: "Sunflower", to: "Sun Peashooter"},
				{from: "Sunflower", to: "Twin Sunflower"},
				{from: "Sunflower", to: "Twin Sunflower"},
				{from: "Peashooter", to: "Repeater"},
				{from: "Peashooter", to: "Repeater"}
			]);
			
			
			// create a network
			var container = document.getElementById('mynetwork');

			// provide the data in the vis format
			var data = {
				nodes: nodes,
				edges: edges
			};
			var options = {
			edges:{
				arrows: 'to',
				font: '12px arial #ff0000',
				scaling:{
				  label: true,
					},
				shadow: true,
				smooth: true,
				}
			}

			// initialize your network!
			var network = new vis.Network(container, data, options);
			
			network.on("selectNode", function (params) {
				var selectedNodes = network.getSelectedNodes();
				if (selectedNodes.length > 0) {
					var selectedNodeId = selectedNodes[0]; // Get the ID of the first selected node
					console.log("Selected node ID:", selectedNodeId);
					// You can now use selectedNodeId to access the node data or perform other actions
					var nodeData = nodes.get(selectedNodeId);
					infoCont.children[0].textContent = nodeData.id;
					infoCont.children[1].textContent = "Sun Cost: " + recursiveSearch(selectedNodeId);
					if('recharge' in nodeData)
					{
						infoCont.children[2].textContent = "Recharge: " + nodeData.recharge;
					}
					else
					{
						infoCont.children[2].textContent = "N/A";
					}
					infoCont.children[3].textContent = nodeData.DPS;
					infoCont.children[4].textContent = nodeData.description;
					const connections = network.getConnectedEdges(selectedNodeId);
					let basePlantList = "";
					let fusionPlantList = "";
					for(let i = 0; i < connections.length; i++)
					{
						console.log(edges.get(connections[i]).to);
						if(edges.get(connections[i]).to == selectedNodeId)
						{
							if(basePlantList == "")
							{
								basePlantList = "Ingredients: ";
								basePlantList = basePlantList + edges.get(connections[i]).from;
							}
							else
							{
								basePlantList = basePlantList + " + ";
								basePlantList = basePlantList + edges.get(connections[i]).from;			
							}
						}
						else
						{
							if(fusionPlantList == "")
							{
								fusionPlantList = "Fusions: ";
								fusionPlantList = fusionPlantList + edges.get(connections[i]).to;
							}
							else
							{
								fusionPlantList = fusionPlantList + " | ";
								fusionPlantList = fusionPlantList + edges.get(connections[i]).to;
							}				
						}
					}
					
					infoCont.children[5].textContent = basePlantList;
					infoCont.children[6].textContent = fusionPlantList;
					
					let keywords = "Keywords: ";
					for(let i = 0; i < nodeData.properties.length; i++)
					{
						if(i != 0)
						{
							keywords = keywords + " | ";
						}
						keywords = keywords + nodeData.properties[i];
					}
					
					infoCont.children[7].textContent = keywords;
					
				}
			});
			network.on("doubleClick", function (params) {
				// Check if a node was double-clicked
				if (params.nodes.length > 0) {
					var nodeId = params.nodes[0]; // Get the ID of the double-clicked node
					console.log("Double-clicked node with ID:", nodeId);
					currentNode = nodes.get(nodeId);
					const connections = network.getConnectedEdges(nodeId);
					for(let k = 0; k < nodeIds.length; k++)
					{
						let node = nodes.get(nodeIds[k]);
						node.hidden = true;
						nodes.update(node);
					}
					currentNode.hidden = false;
					nodes.update(currentNode);
					for(let i = 0; i < connections.length; i++)
					{
						let tempNode;
						if(edges.get(connections[i]).to == nodeId)
						{
							tempNode = nodes.get(edges.get(connections[i]).from);	
						}
						else
						{
							tempNode = nodes.get(edges.get(connections[i]).to);
						}
						tempNode.hidden = false;
						nodes.update(tempNode);
					}
					
					
				}
			});
			network.on("click", function (params) {
				// Check if a node was double-clicked
				if (params.nodes.length <= 0 && params.edges.length <=0) {
					searchPlants();
					
				}
			});
			function recursiveSearch(newId)
			{
				if('cost' in nodes.get(newId))
				{
					console.log(newId + nodes.get(newId).cost);
					return nodes.get(newId).cost;
				}
				else
				{
					const connections = network.getConnectedEdges(newId);
					let tempTotal = 0;
					for(let i = 0; i < connections.length; i++)
					{
						if(edges.get(connections[i]).to == newId)
						{
							tempTotal = tempTotal + recursiveSearch(edges.get(connections[i]).from);
						}
					}					
					return tempTotal;		
				}
			}
			
			function searchPlants()
			{
				for(let k = 0; k < nodeIds.length; k++)
				{
					let node = nodes.get(nodeIds[k]);
					node.hidden = true;
					nodes.update(node);
					
				}
				for(let i = 0; i < tickboxes.length; i++)
				{
					let propertyValue = tickboxes[i].value;
					for(let k = 0; k < nodeIds.length; k++)
					{
						let node = nodes.get(nodeIds[k]);
						if(node.properties.includes(propertyValue))
						{
							if(tickboxes[i].checked == true)
							{
								node.hidden = false;
								nodes.update(node);
							}
						}
						
					}
				}
			}
		</script>
	</body>
</html>