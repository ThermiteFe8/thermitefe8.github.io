<!DOCTYPE html>
<html>
	<head>
		<title>Page Title</title>
	</head>
	<body>

		<style>
			#leftLight
			{
				background-color:black;
				border: 3px solid lightgray;
				width:150px;
				height:150px;
			}
			#rightLight
			{
				background-color:black;
				border: 3px solid lightgray;
				width:150px;
				height:150px;
			}
			#lightContainer
			{
				display:flex;
			}
		</style>
		<h1 id="display">This is a Heading</h1>
		<div id="lightContainer">
			<div id="leftLight"> </div>
			<div id="rightLight"> </div>
		</div>
		<button onclick="startTimer()">Start</button>
		<button onclick="stopTimer()">Stop</button>
		<button onclick="resetTimer()">Reset</button>
		<button onclick = "toggleLeftLight()">Left Light</button>
		<button onclick = "toggleRightLight()">Right Light</button>
		<script type="text/javascript">
			let timer = 0;
			let ticking = false;
			let offset = 0;
			const display = document.getElementById("display");
			const leftLight = document.getElementById("leftLight");
			const rightLight = document.getElementById("rightLight");
			let interval;
			let timeArray = [];
			
			
			fetch("https://thermitefe8.github.io/rockyLighting/csvjson.json")
			.then(response => response.json())
			.then(data => 
			{
				timeArray = data;
				console.log(data);			
			});
				
				
			
			
			function LeftOn()
			{
				leftLight.style.backgroundColor = "yellow";
			}
			function LeftOff()
			{
				leftLight.style.backgroundColor = "black";
			}
			
			function RightOn()
			{
				rightLight.style.backgroundColor = "yellow";
			}
			function RightOff()
			{
				rightLight.style.backgroundColor = "black";
			}
			
			function toggleLeft(on)
			{
				
				if(on == true)
				{
					LeftOn();
				}
				else
				{
					LeftOff();
				}
			}
			
			function toggleRight(on)
			{
				
				if(on == true)
				{
					RightOn();
				}
				else
				{
					RightOff();
				}
			}
		
			
			function update()
			{
				if(ticking == true)
				{
					timer += delta();
					render();
					let finishedEvents = [];
					for(let i = 0; i < timeArray.length; i++)
					{
						if(timeArray[i].Timestamp__1 <= timer)
						{
							let tempHolder = false;
							if(timeArray[i].LeftLight != "")
							{
								console.log(timeArray[i].LeftLight);
								tempHolder = true;
								toggleLeft(timeArray[i].LeftLight);
							}
							
							if(timeArray[i].RightLight != "")
							{
								tempHolder = true;
								toggleRight(timeArray[i].RightLight);
							}
							
							if(tempHolder == true)
							{
								finishedEvents.push(i);
							}
						}
					}
					
					for(let i = 0; i < finishedEvents.length; i++)
					{
						timeArray.splice(i, 1);
						console.log(timeArray);
					}
				}	
			}
			
			function startTimer()
			{
				offset = Date.now();
				ticking = true;
				interval = setInterval(update, 1);
				console.log("Starting");
			}
			
			function resetTimer()
			{
				timer = 0;
				render();
			}
			
			function stopTimer()
			{
				ticking = false;
				if (interval) 
				{
					clearInterval(interval);
					interval = null;
				}
			}
			
			function delta() 
			{
				var now = Date.now(),
				d = now - offset;

				offset = now;
				return d;
			}
			
			function render() 
			{
				display.innerHTML = timer;
			}
		</script>
	</body>
</html>
